env:
  - secure: sVgQpNDtFcmhyD1KUDxYen8C4lOWzpvtJA7GDkiSvaN00WYq4BSsrcSE28ue+2Tjnx9nrybzTGzjILLpboc1fdd44NUJl7okKYaot2ExkTL38z0eASwXxh57XSrcvuhkWcSJtayuhJoNEoemVkpsK/rnabMdWA23uZYLLmM5399g38yP8pzHKuYZADRVYVSRov+Rf+Thaifvca7eUZRppFDS1vX2uxpsEut3QgNTFabPcVEPMianNNiA4iU88PnGzo7PjroDpl1Zg79OVIM5IZVTpZ9ooMWCPAUxAtaJyKgFvxJh2c/krSJzLHlikrId9hcnFXVsYQKu1fzmstoz3E/ulTI8CIWxEBOUvldtJPZDM0MyclCx5/007e1X4/L10VXCJs2UUtc9dcr76XD7MRwAzpdmFvac8cu1UgUA0nVixYzPmXQqLwlkSJAi+kEqYdfzSElGf7rkaJ11fMj0+KASxyaARTClgG5cSTb5lN1ziPHzbxaKI1cw08B3fVGIZGLyYBErkZbAwBWFMwlhS7JWbqWUO7QxtYBczunmRz+j6zS8B218BGvOg0XA4UHsUTzMdd1XasEo0uVI7lgNv7e5oPM2W3qTDIfHH8uYdsJHOU/UYD1YDAL5+4+qJ4H+roDOWUTDn+OBZqoCmk0JbgWujUjPPAP2LhxQh+UC8ao=
  - secure: "PR0T5gjyCPmfvdPNL+W3qv6IAZST6UqYpRdizuGMncRJKJ724czcF9kJaU1dC3VgCLxvffKPr8vCFJbRXutJi4QHyZdbOUgRhQIb66ZuTjncaAEGcCVQN7FkrRakHO443UpuQbqbpxLmbVNN3CfQ3R/Yr2D13/EHmYOvMNatk/Q7u3i/86+/SL68nJLGsf7/rB2iIbcTrleOkonoAImgIw3GvBQSXcucxAyxZV0rpIXOC18wjTJKI0leMVMW/pldaktbgILer/mIapK6+72beqp6W27JNoigbkUy3/8Iz0VaAqJWBIbXiLzlNJDBFyxlqk/jLybzzGVchF5iuMXt96Bsie1doxeK4y3N0HFZ4LVXsLKNyVn8pu7Mhrcw59ai47gjWWdT18yiooNEHeHqVF6IFZSzq2sbiNw3f6ni0BwhQrRkjiTo1/014lwpQGi/9M6u7hUmvPhcC8AnMhgUJaeEz34yug8N4ewPuTn1y+LO69/qMENDZIzCz0zTHhH34C6m/Cau/Bq0906sqJ6B2xSB5AublgLO4xF98nIbNAmZh5AIJNVNL3gOuvJQuCGD6FJ+nGfW2zq/Eqbuvg9KbyfMYlYvhGZGOVsvY2Wtvquiogcito/xrIyOBQNobFNLtg5U/Ql7d8Wllc85PYFQd+WOAkEAr5kKb8EqiioMILc="
  - TERRAFORM_BUILD=terraform_build
  
before_install:
  - git clone https://github.com/LinuxAdeptLtd/Docker-Terraform.git ${TERRAFORM_BUILD}
  - docker build -t terraform -f ${TERRAFORM_BUILD}/Dockerfile .
  - docker run --rm -e AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID} -e AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY} -v $(pwd)/terraform:/data terraform init
  - docker run --rm -e AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID} -e AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY} -v $(pwd)/terraform:/data terraform workspace select production

script:
  - docker run --rm -e AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID} -e AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY} -v $(pwd)/terraform:/data terraform apply -auto-approve -refresh=true -var-file production.tfvars
